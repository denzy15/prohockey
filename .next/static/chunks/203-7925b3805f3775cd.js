"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{1203:function(e,r,t){t.d(r,{ot:function(){return _},ww:function(){return q},$s:function(){return R}});var a=t(5893),n=t(7294),i=t(2191),s=t(4246),l=t(6799),c=t(832),o=t(5307);let d=(0,n.createContext)({}),u=e=>{let{children:r,initialProducts:t}=e,[i,s]=(0,n.useState)(t),[l,c]=(0,n.useState)("popularity");return console.log(i),(0,a.jsx)(d.Provider,{value:{products:i,sort:l,setSort:e=>{c(e),"popularity"===e?s(t):s(e=>e.sort((e,r)=>"price-desc"===l?e.basePrice-r.basePrice:"price-asc"===l?r.basePrice-e.basePrice:0))},setProducts:s},children:r})},x=()=>(0,n.useContext)(d);var h=()=>{let{sort:e,setSort:r}=x();return(0,a.jsxs)(i.Z,{sx:{bgcolor:"background.default",display:"flex",justifyContent:"start",alignItems:"center",gap:3,px:2,py:1,my:1},children:[(0,a.jsx)(s.Z,{children:"Сортировать по"}),(0,a.jsx)(l.Z,{children:(0,a.jsxs)(c.Z,{variant:"standard",value:e,onChange:e=>{r(e.target.value)},children:[(0,a.jsx)(o.Z,{value:"popularity",children:"Популярные"}),(0,a.jsx)(o.Z,{value:"price-asc",children:"Цена: по возрастанию"}),(0,a.jsx)(o.Z,{value:"price-desc",children:"Цена: по убыванию"})]})})]})},p=t(4466),m=t(603),j=t(3821),f=t(7868),v=t(4324),Z=t(9203),g=t(1664),C=t.n(g),y=t(1163),b=e=>{let{category:r}=e,{asPath:t}=(0,y.useRouter)();return(0,a.jsx)(p.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(j.Z,{sx:{bgcolor:"white"},children:(0,a.jsx)(C(),{href:"".concat(t,"/").concat(r.urlPath),children:(0,a.jsxs)(f.Z,{children:[(0,a.jsx)(v.Z,{component:"img",image:"".concat(m.LB,"/").concat(r.photo),height:"190",alt:r.name,sx:{objectFit:"contain"}}),(0,a.jsx)(Z.Z,{sx:{bgcolor:"primary.light"},children:(0,a.jsx)(s.Z,{variant:"body2",sx:{color:"background.paper",fontWeight:600,textAlign:"center"},children:r.name.toUpperCase()})})]})})})})},_=e=>{let{categories:r}=e;return(0,a.jsx)(p.ZP,{container:!0,spacing:2,sx:{py:3},children:r.map(e=>(0,a.jsx)(b,{category:e},e._id))})},P=t(578),S=t(4440),w=t(5416),k=t(8163),I=t(4144),W=t(531),E=t(3151),J=t(5678),N=t(8656);let A=(e,r)=>e.every((e,t)=>e.value._id===r[t].value._id);var B=e=>{let{product:r}=e,{category:t}=(0,y.useRouter)().query,{cart:d,addToCart:u,removeFromCart:x}=(0,N.jD)(),[h,p]=(0,n.useState)(!1),[j,f]=(0,n.useState)(()=>{let e=[...r.parameters],t=0;return e=e.map(e=>{let r=e.values.find(e=>e.defaultValue);return r.extraPrice&&(t+=r.extraPrice),{name:e.name,value:r,_id:e._id}}),{...r,parameters:e,cartCounter:1,finalPrice:r.basePrice+t}});(0,n.useEffect)(()=>{p(d.some(e=>e._id===j._id&&A(j.parameters,e.parameters)));let e=r.basePrice;j.parameters.forEach(r=>{r.value.extraPrice&&(e+=r.value.extraPrice)}),f({...j,finalPrice:e})},[d,j.parameters,d,r._id]);let v=(e,t)=>{let a=[...j.parameters],n=r.parameters.findIndex(r=>r._id===e),i=r.parameters[n].values.find(e=>e._id===t);i&&(a[n].value=i,f(e=>({...e,parameters:a,photo:i.photo?i.photo:j.photo})))};return(0,a.jsxs)(i.Z,{sx:{bgcolor:"text.primary",color:"background.paper",transition:"0.1s",height:"100%",display:"flex",flexDirection:"column","&:hover":{transform:"scale(1.001)"}},elevation:5,children:[(0,a.jsx)(C(),{href:"/products/".concat(t,"/").concat(j.name),passHref:!0,style:{flex:1},children:(0,a.jsxs)(S.Z,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,a.jsx)(S.Z,{sx:{height:240},children:(0,a.jsx)("img",{src:"".concat(m.LB,"/").concat(j.photo),alt:j.name,style:{width:"100%",height:"100%",objectFit:"contain"}})}),(0,a.jsxs)(S.Z,{sx:{p:1,textAlign:"center",justifySelf:"end"},children:[(0,a.jsx)(s.Z,{gutterBottom:!0,variant:"body2",children:j.name}),(0,a.jsxs)(s.Z,{variant:"h6",sx:{fontWeight:600},children:[(0,I.Jw)(j.finalPrice)," ₸"]})]})]})}),(0,a.jsxs)(S.Z,{sx:{p:2,bgcolor:"background.paper"},children:[r.parameters.map((e,r)=>(0,a.jsxs)(l.Z,{fullWidth:!0,sx:{mb:2},variant:"outlined",children:[(0,a.jsx)(w.Z,{children:e.name}),(0,a.jsx)(c.Z,{value:j.parameters[r].value._id,onChange:r=>v(e._id,r.target.value),children:e.values.map(e=>(0,a.jsx)(o.Z,{value:e._id,children:e.value},e.value))})]},e.name)),(0,a.jsx)(S.Z,{sx:{mb:2,textAlign:"center"},children:(0,a.jsx)(E.Z,{isInCart:h,cartCounter:j.cartCounter,handleChangeCartCounter:e=>{if("remove"===e){if(j.cartCounter<=1){f({...j,cartCounter:1});return}f(e=>({...e,cartCounter:--e.cartCounter}));return}if(j.cartCounter>=10){f({...j,cartCounter:10}),J.Am.info("Для оптовой покупки на выгодных условиях свяжитесь с нами по телефону");return}f(e=>({...e,cartCounter:++e.cartCounter}))}})}),h?(0,a.jsx)(k.Z,{startIcon:(0,a.jsx)(W.Z,{}),fullWidth:!0,variant:"outlined",color:"error",onClick:()=>{h&&x(d.findIndex(e=>e._id===j._id&&A(j.parameters,e.parameters)))},children:"Удалить из корзины"}):(0,a.jsx)(k.Z,{startIcon:(0,a.jsx)(W.Z,{}),fullWidth:!0,variant:"contained",color:"primary",onClick:()=>{u(JSON.parse(JSON.stringify(j))),p(!0)},children:"В корзину"})]})]})},D=()=>{let{products:e}=x();return e.length>0?(0,a.jsx)(p.ZP,{container:!0,rowSpacing:2,columnSpacing:5,sx:{my:2},children:e.map(e=>(0,a.jsx)(p.ZP,{item:!0,xs:12,sm:6,md:4,children:(0,a.jsx)(B,{product:e})},e._id))}):(0,a.jsx)(P.Z,{severity:"info",sx:{textTransform:"uppercase",my:1},children:"Товары не найдены"})},R=e=>{let{initialProducts:r}=e;return(0,a.jsxs)(u,{initialProducts:r,children:[(0,a.jsx)(h,{}),(0,a.jsx)(D,{})]})},L=t(5465),O=t(8207),F=t(1946),V=e=>{let{param:r,handleSelect:t,activeValue:n}=e,i=!!r.values[0].photo;return(0,a.jsxs)(S.Z,{sx:{my:2},children:[(0,a.jsxs)(s.Z,{variant:"body2",sx:{mb:1},children:[r.name,": ",n.value]}),(0,a.jsx)(L.Z,{direction:"row",gap:1,flexWrap:"wrap",children:i?r.values.map((e,i)=>(0,a.jsx)(S.Z,{onClick:()=>t(r._id,e),sx:{cursor:"pointer",borderStyle:n._id===e._id?"solid":"dashed",borderColor:n._id===e._id?"black":"primary.main",borderWidth:n._id===e._id?3:1,borderRadius:2,overflow:"hidden"},children:(0,a.jsx)(O.Z,{title:e.value,children:(0,a.jsx)("img",{style:{maxWidth:"60px"},src:"".concat(m.LB,"/").concat(e.photo)})})},i)):r.values.map((e,i)=>(0,a.jsx)(F.Z,{variant:n._id===e._id?"outlined":"filled",onClick:()=>t(r._id,e),label:e.value,sx:{bgcolor:"primary.light",color:"background.default",borderRadius:3,borderColor:"primary.main",fontWeight:500,fontSize:15}},i))})]})},q=e=>{let{product:r}=e,{name:t,shortDescription:i,detailedDescription:l,parameters:c,_id:o}=r,{cart:d,addToCart:u,removeFromCart:x}=(0,N.jD)(),[h,p]=(0,n.useState)(!1),{query:j}=(0,y.useRouter)(),[f,v]=(0,n.useState)(()=>{let e=[...r.parameters],t=0;return e=e.map(e=>{let r=e.values.find(e=>e.defaultValue);return r.extraPrice&&(t+=r.extraPrice),{name:e.name,value:r,_id:e._id}}),{...r,parameters:e,cartCounter:1,finalPrice:r.basePrice+t}});(0,n.useEffect)(()=>{let e;let r=[...f.parameters];c.forEach((t,a)=>{if(j[t.name]){let n=t.values.find(e=>e.value===j[t.name]);n&&(r[a].value=n,n.photo&&(e=n.photo))}}),v(t=>({...t,parameters:r,photo:e||t.photo}))},[j]),(0,n.useEffect)(()=>{p(d.some(e=>e._id===f._id&&A(f.parameters,e.parameters)));let e=f.parameters.reduce((e,r)=>r.value.extraPrice||0+e,f.basePrice);v({...f,finalPrice:e})},[d,f.parameters,d,o]);let Z=(e,r)=>{let t=[...f.parameters];t[c.findIndex(r=>r._id===e)].value=r,v(e=>({...e,parameters:t,photo:r.photo?r.photo:f.photo}))};return(0,a.jsxs)(S.Z,{sx:{my:2},children:[(0,a.jsxs)(L.Z,{sx:{gap:2,flexDirection:{md:"row",xs:"column"}},children:[(0,a.jsx)(S.Z,{sx:{flex:"1 0 50%"},children:(0,a.jsx)("img",{style:{height:500,width:"100%",objectFit:"contain"},src:"".concat(m.LB,"/").concat(f.photo)})}),(0,a.jsxs)(S.Z,{sx:{flexGrow:1},children:[(0,a.jsx)(s.Z,{variant:"h5",children:t}),(0,a.jsx)(s.Z,{variant:"body1",sx:{my:2},children:i}),(0,a.jsxs)(s.Z,{variant:"h6",sx:{color:"primary.main"},children:[(0,I.Jw)(f.finalPrice)," ₸"]}),c.map((e,r)=>(0,a.jsx)(V,{activeValue:f.parameters[r].value,handleSelect:Z,param:e},e._id)),(0,a.jsxs)(S.Z,{sx:{display:"flex",alignItems:"center",gap:2,my:2},children:[(0,a.jsx)(E.Z,{handleChangeCartCounter:e=>{if("remove"===e){if(f.cartCounter<=1){v({...f,cartCounter:1});return}v(e=>({...e,cartCounter:--e.cartCounter}));return}if(f.cartCounter>=10){v({...f,cartCounter:10}),J.Am.info("Для оптовой покупки на выгодных условиях свяжитесь с нами по телефону");return}v(e=>({...e,cartCounter:++e.cartCounter}))},isInCart:h,cartCounter:f.cartCounter}),h?(0,a.jsx)(k.Z,{startIcon:(0,a.jsx)(W.Z,{}),fullWidth:!0,variant:"outlined",color:"error",onClick:()=>{h&&x(d.findIndex(e=>e._id===f._id&&A(f.parameters,e.parameters)))},children:"Удалить из корзины"}):(0,a.jsx)(k.Z,{startIcon:(0,a.jsx)(W.Z,{}),fullWidth:!0,variant:"contained",color:"primary",onClick:()=>{u(JSON.parse(JSON.stringify(f))),p(!0)},children:"В корзину"})]})]})]}),(0,a.jsxs)(S.Z,{children:[(0,a.jsx)(s.Z,{variant:"h5",sx:{mt:3,mb:2},children:"Описание товара:"}),(0,a.jsx)(s.Z,{sx:{whiteSpace:"pre-line"},children:l})]})]})}}}]);